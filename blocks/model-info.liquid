{%- liquid
  assign block_settings = block.settings
  assign model_info_reference = closest.product.metafields.models.model_info
  assign model_info = nil

  if model_info_reference and model_info_reference.value
    assign model_info = model_info_reference.value
  endif

  assign model_name = ''
  assign wearing_size_from_metaobject = ''
  assign bust_measurement = ''
  assign height_measurement = ''
  assign waist_measurement = ''
  assign hips_measurement = ''

  if model_info != nil
    assign model_name = model_info.model | default: model_info.name | default: model_info.title
    assign wearing_size_from_metaobject = model_info.wearing_size | default: model_info.size | default: model_info.wearing_size_text

    if model_info.bust != blank
      assign bust_measurement = model_info.bust
    endif
    if model_info.height != blank
      assign height_measurement = model_info.height
    endif
    if model_info.waist != blank
      assign waist_measurement = model_info.waist
    endif
    if model_info.hips != blank
      assign hips_measurement = model_info.hips
    endif
  endif

  assign product_wearing_size = ''
  assign product_wearing_size_metafield = ''

  if closest.product.metafields.custom and closest.product.metafields.custom.wearing_size != blank
    assign product_wearing_size_metafield = closest.product.metafields.custom.wearing_size
  elsif closest.product.metafields.model and closest.product.metafields.model.wearing_size != blank
    assign product_wearing_size_metafield = closest.product.metafields.model.wearing_size
  elsif closest.product.metafields.models and closest.product.metafields.models.wearing_size != blank
    assign product_wearing_size_metafield = closest.product.metafields.models.wearing_size
  endif

  if product_wearing_size_metafield != blank
    assign product_wearing_size = product_wearing_size_metafield.value | default: product_wearing_size_metafield
  endif

  assign model_name = model_name | strip
  assign wearing_size = wearing_size_from_metaobject | default: product_wearing_size | strip

  assign has_content = false
  if model_name != blank or wearing_size != blank or bust_measurement != blank or height_measurement != blank or waist_measurement != blank or hips_measurement != blank
    assign has_content = true
  endif
-%}

<script src="{{ 'model-info.js' | asset_url }}" defer></script>

  {% if has_content %}
    <model-info-card
      model="{{ model_name | escape }}"
      wearing-size="{{ wearing_size | escape }}"
      height="{{ height_measurement.value }}"
      bust="{{ bust_measurement.value }}"
      waist="{{ waist_measurement.value }}"
      hips="{{ hips_measurement.value }}"
      model-label="{{ block_settings.model_label | default: 'Model' }}"
      size-label="{{ block_settings.size_label | default: 'Wearing size' }}"
      height-label="{{ block_settings.height_label | default: 'Height' }}"
      bust-label="{{ block_settings.bust_label | default: 'Bust' }}"
      waist-label="{{ block_settings.waist_label | default: 'Waist' }}"
      hips-label="{{ block_settings.hips_label | default: 'Hips' }}"
      {{ block.shopify_attributes }}
    ></model-info-card>
  {% elsif request.design_mode %}
    <div
      class="model-info-block model-info-block--placeholder spacing-style"
      style="
        {% render 'spacing-style', settings: block_settings %}
        text-align: {{ block_settings.alignment }};
      "
      {{ block.shopify_attributes }}
    >
      {% assign placeholder_heading = block_settings.heading | default: 'Model info' %}
      <p class="model-info-block__heading {{ block_settings.heading_style | default: 'heading' }}">
        {{ placeholder_heading }}
      </p>
      <p class="model-info-block__placeholder-note">
        Add a model info metaobject to this product to display data.
      </p>
    </div>
  {% endif %}
  
{% stylesheet %}
  .model-info-block {
    display: grid;
    gap: clamp(12px, 2vw, 20px);
  }

  .model-info-block__heading {
    margin: 0;
  }

  .model-info-block__card {
    display: grid;
    gap: clamp(16px, 2.5vw, 24px);
    padding: clamp(16px, 3vw, 28px);
    border-radius: var(--radius-card, 18px);
    background: linear-gradient(
        135deg,
        rgb(var(--color-background-rgb, 255 255 255) / 0.95),
        rgb(var(--color-background-secondary-rgb, 248 248 248) / 0.85)
      );
    border: 1px solid rgb(var(--color-border-rgb, 0 0 0) / 0.08);
    box-shadow: 0 18px 40px rgb(var(--color-shadow-rgb, 10 22 70) / 0.08);
  }

  .model-info-block__identity {
    display: flex;
    flex-wrap: wrap;
    gap: clamp(12px, 2vw, 18px);
    align-items: center;
  }

  .model-info-block__identity-item {
    display: grid;
    gap: 6px;
    min-width: 140px;
  }

  .model-info-block__identity-item--pill {
    align-items: flex-start;
  }

  .model-info-block__label {
    font-size: 0.75rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-weight: var(--font-paragraph--weight, 500);
    color: rgb(var(--color-foreground-rgb) / var(--opacity-subdued-text, 0.55));
  }

  .model-info-block__value {
    font-size: clamp(1.15rem, 2.5vw, 1.5rem);
    font-weight: var(--font-heading--weight, 600);
    color: rgb(var(--color-foreground-rgb));
  }

  .model-info-block__pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 0.35rem 0.85rem;
    border-radius: 999px;
    font-size: 0.95rem;
    font-weight: var(--font-paragraph--weight-bold, 600);
    background: rgb(var(--color-accent-rgb, 0 122 255) / 0.15);
    color: rgb(var(--color-accent-rgb, 0 122 255));
  }

  .model-info-block__metrics {
    display: grid;
    gap: clamp(12px, 2vw, 18px);
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  }

  .model-info-block__metric {
    display: grid;
    gap: 6px;
    padding: clamp(14px, 2.2vw, 18px);
    border-radius: var(--radius-btn, 14px);
    background: rgb(var(--color-background-rgb, 255 255 255) / 1);
    border: 1px solid rgb(var(--color-border-rgb, 0 0 0) / 0.08);
    box-shadow: inset 0 0 0 1px rgb(var(--color-border-rgb, 0 0 0) / 0.03);
  }

  .model-info-block__metric-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgb(var(--color-foreground-rgb) / var(--opacity-subdued-text, 0.55));
  }

  .model-info-block__metric-value {
    font-size: clamp(1rem, 2vw, 1.25rem);
    font-weight: var(--font-heading--weight, 600);
    color: rgb(var(--color-foreground-rgb));
  }

  .model-info-block--placeholder {
    border: 1px dashed rgb(var(--color-border-rgb, 0 0 0) / 0.25);
    border-radius: var(--radius-card, 18px);
    padding: clamp(16px, 3vw, 28px);
    background: rgb(var(--color-background-rgb, 255 255 255) / 0.6);
  }

  .model-info-block__placeholder-note {
    margin: 0;
    font-size: 0.9rem;
    color: rgb(var(--color-foreground-rgb) / var(--opacity-subdued-text, 0.65));
  }

  @media (max-width: 480px) {
    .model-info-block__identity-item {
      min-width: 100%;
    }
  }
{% endstylesheet %}
  
  {% schema %}
  {
    "name": "Model info",
    "tag": null,
    "settings": [
      {
        "type": "header",
        "content": "Content"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Model info"
      },
      {
        "type": "select",
        "id": "heading_style",
        "label": "Heading style",
        "options": [
          {
            "value": "heading",
            "label": "Theme heading"
          },
          {
            "value": "subheading",
            "label": "Theme subheading"
          },
          {
            "value": "body",
            "label": "Body"
          }
        ],
        "default": "heading"
      },
      {
        "type": "text",
        "id": "model_label",
        "label": "Model label",
        "default": "Model"
      },
      {
        "type": "text",
        "id": "size_label",
        "label": "Size label",
        "default": "Wearing size"
    },
    {
      "type": "text",
      "id": "height_label",
      "label": "Height label",
      "default": "Height"
    },
    {
      "type": "text",
      "id": "bust_label",
      "label": "Bust label",
      "default": "Bust"
    },
    {
      "type": "text",
      "id": "waist_label",
      "label": "Waist label",
      "default": "Waist"
    },
    {
      "type": "text",
      "id": "hips_label",
      "label": "Hips label",
      "default": "Hips"
    },
      {
        "type": "select",
        "id": "alignment",
        "label": "Text alignment",
        "options": [
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "right",
            "label": "Right"
          }
        ],
        "default": "left"
      },
      {
        "type": "header",
        "content": "Appearance"
      },
      {
        "type": "select",
        "id": "border",
        "label": "Border",
        "options": [
          {
            "value": "none",
            "label": "None"
          },
          {
            "value": "top",
            "label": "Top"
          },
          {
            "value": "bottom",
            "label": "Bottom"
          },
          {
            "value": "full",
            "label": "Outline"
          }
        ],
        "default": "none"
      },
      {
        "type": "range",
        "id": "border_width",
        "label": "Border width",
        "min": 1,
        "max": 10,
        "step": 1,
        "unit": "px",
        "default": 1,
        "visible_if": "{{ block.settings.border != 'none' }}"
      },
      {
        "type": "range",
        "id": "border_opacity",
        "label": "Border opacity",
        "min": 0,
        "max": 100,
        "step": 5,
        "unit": "%",
        "default": 100,
        "visible_if": "{{ block.settings.border != 'none' }}"
      },
      {
        "type": "range",
        "id": "border_radius",
        "label": "Border radius",
        "min": 0,
        "max": 32,
        "step": 1,
        "unit": "px",
        "default": 8,
        "visible_if": "{{ block.settings.border == 'full' }}"
      },
      {
        "type": "header",
        "content": "Spacing"
      },
      {
        "type": "range",
        "id": "padding-block-start",
        "label": "Padding top",
        "min": 0,
        "max": 80,
        "step": 4,
        "unit": "px",
        "default": 16
      },
      {
        "type": "range",
        "id": "padding-block-end",
        "label": "Padding bottom",
        "min": 0,
        "max": 80,
        "step": 4,
        "unit": "px",
        "default": 16
      },
      {
        "type": "range",
        "id": "padding-inline-start",
        "label": "Padding left",
        "min": 0,
        "max": 80,
        "step": 4,
        "unit": "px",
        "default": 16
      },
      {
        "type": "range",
        "id": "padding-inline-end",
        "label": "Padding right",
        "min": 0,
        "max": 80,
        "step": 4,
        "unit": "px",
        "default": 16
      }
    ]
  }
  {% endschema %}
  
  